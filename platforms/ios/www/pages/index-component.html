<template>
  <div class="page">
        <div class="navbar">
          <div class="navbar-inner">
            <div class="left">
              <a href="#" class="link icon-only panel-open" data-panel="left">
                <i class="icon f7-icons ios-only">menu</i>
                <i class="icon material-icons md-only">menu</i>
              </a>
            </div>
            <div class="title sliding">NEST+m Event App Test</div>
            <div class="right">
              <a class="link icon-only searchbar-enable" data-searchbar=".searchbar-components">
                <i class="icon f7-icons ios-only">search_strong</i>
                <i class="icon material-icons md-only">search</i>
              </a>
            </div>
            <form data-search-container=".components-list" data-search-in="a" class="searchbar searchbar-expandable searchbar-components searchbar-init">
              <div class="searchbar-inner">
                <div class="searchbar-input-wrap">
                  <input type="search" placeholder="Search components"/>
                  <i class="searchbar-icon"></i>
                  <span class="input-clear-button"></span>
                </div>
                <span class="searchbar-disable-button">Cancel</span>
              </div>
            </form>
          </div>
        </div>
        <div class="page-content">
          {{#each months}}
          <div class="block-title searchbar-found">{{month}}</div>
          
          <div class="list accordion-list components-list searchbar-found">
            <ul>
              {{#each events}}
              <li class="accordion-item">
                <a href="#" class="item-content item-link">
                  <div class="item-inner">
                    <div class="item-title">{{name}}</div>
                  </div>
                </a>
                <div class="accordion-item-content">
                  <div class="block">
                    <p>{{description}}</p>
                  </div>
                </div>
              </li>
              {{/each}}
            </ul>
          </div>
          
        {{/each}}
        </div>
      </div>
</template>
<style>
  p {
    margin: 10px;
  }
</style>
<script>

  
  return {
    // Lifecycle Hooks
    beforeCreate() {
      console.log('componentBeforeCreate', this);
    },
    created() {
      console.log('componentCreated', this)
    },
    beforeMount() {
      console.log('componentBeforeMount', this)
    },
    mounted() {
      console.log('componentMounted', this);
    },
    beforeDestroy() {
      console.log('componentBeforeDestroy', this);
    },
    destroyed() {
      console.log('componentDestroyed', this);
    },
    // Component Data
    data: function() {
      return {
        months: getEventsByKey()
        // months: [{month: 'January', events: [{key: "-L-xA-oxq--Xe88RZU3N", name: "Mid Winter Jan Break 4", date: "2018-01-18", club: undefined, description: ""}]}]
      }
    },
    // Component Methods
    methods: {
      openAlert: function() {
        var self = this;
        self.$app.dialog.alert('Hello World');
      },
    },
    // Page Events
    on: {
      pageMounted: function(e, page) {
        console.log('pageMounted', page);
      },
      pageInit: function(e, page) {
        console.log('pageInit', page);
      },
      pageBeforeIn: function(e, page) {
        console.log('pageBeforeIn', page);
      },
      pageAfterIn: function(e, page) {
        console.log('pageAfterIn', page);
      },
      pageBeforeOut: function(e, page) {
        console.log('pageBeforeOut', page);
      },
      pageAfterOut: function(e, page) {
        console.log('pageAfterOut', page);
      },
      pageBeforeRemove: function(e, page) {
        console.log('pageBeforeRemove', page);
      },
    }
  }
  
  // firebase access
  function getEventsByKey() {
  function eventMonth(date) {
    month = date.substring(5, 7);
    return month;
  }

  var elist = [];
  for (var i = 0; i < 12; i++) {
    elist[i] = [];
  }

  //  this will get fired on inital load as well as when ever there is a change in the data
  eventsRef.on("value", function(snapshot) {
    // console.log(snapshot.val());
    var data = snapshot.val();

    for (var key in data) {
      if (data.hasOwnProperty(key)) {
        name = data[key].name ? data[key].name : '';
        date = data[key].date;
        // if (name.trim().length > 0) {
          elist[eventMonth(date)-1].push({
            key: key,
            name: name,
            date: date,
            club: data[key].club,
            description: data[key].description,
            room: data[key].room,
            email: data[key].email,
            time: data[key].time
          })
        // }
      }
    }

    // refreshEventEdit(elist);
  
  
  // console.log(elist);
  
  var monthName = ["January", "Februrary", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
  var months = [];
  for (var i = 0; i < 12; i++) {
    // console.log(elist[i]);
    months[i] = {
      month: monthName[i],
      events: elist[i]
    }
  }
  console.log(months);
  return months;
  
  })
}

  
</script>
